<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>KOBLLUX Editor Mix</title>
<meta name="theme-color" content="#0a0e18" />

<link rel="manifest" href="manifest.webmanifest" />
<link rel="icon" href="icons/icon-192.png" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<style>
:root{
  --bg:#0a0e18;--ink:#e8ecf6;--muted:#9fb3c7;--ring:rgba(255,255,255,.12);
  --panel:#0f1424;--accent:#36f6a2;--gradA:#ff00ff;--gradB:#00ffff;
}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
  font:500 15px/1.4 'Inter',system-ui;height:100%;overflow:hidden}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
#app{display:flex;flex-direction:column;height:100%;overflow:hidden;}

/* header */
header{
  background:linear-gradient(42deg,var(--gradA),var(--gradB));
  color:#071018;font-weight:800;text-align:center;padding:10px 8px;
  border-bottom:1px solid var(--ring); position:relative;
}
header .row{display:flex;gap:8px;justify-content:space-between;align-items:center}
header .title{font-weight:900}

/* main */
main{flex:1;display:flex;flex-direction:column;overflow:hidden;}
#editor{flex:1;resize:none;width:100%;border:0;padding:14px;background:var(--panel);
  color:var(--ink);font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
  outline:none;font-size:.95rem;line-height:1.4;overflow:auto;}
#preview{flex:1;background:#000;border-top:1px solid var(--ring);position:relative;}
iframe{width:100%;height:100%;border:0;background:#000;}

/* toolbar */
.toolbar{display:flex;gap:6px;flex-wrap:wrap;justify-content:space-between;padding:8px;background:#0c1324;border-top:1px solid var(--ring);}
button{
  flex:1 1 auto;min-width:120px;margin:0 2px;padding:10px;border-radius:10px;border:1px solid var(--ring);
  background:var(--panel);color:var(--ink);font-weight:600;transition:.2s ease;cursor:pointer;
}
button:hover{background:#10182c}
button.primary{background:linear-gradient(42deg,var(--gradA),var(--gradB));color:#071018;border:0;font-weight:800;}
button.save{background:var(--accent);color:#000;border:0;font-weight:800;}
button.ghost{background:#0b1223}

/* utility */
.hidden{display:none!important}

/* gsap helpers */
.fade-enter{opacity:0;transform:translateY(10px);}
#loader{
  position:fixed;inset:0;background:#0a0e18;display:flex;align-items:center;justify-content:center;
  color:var(--accent);font-size:2rem;z-index:99;transition:opacity .5s ease;
}
#loader.hide{opacity:0;pointer-events:none;}
#loader .orb{width:48px;height:48px;border-radius:999px;border:2px solid currentColor;
  display:flex;align-items:center;justify-content:center;animation:orbPulse 2s infinite ease-in-out;}
@keyframes orbPulse{0%,100%{opacity:.3;transform:scale(1)}50%{opacity:1;transform:scale(1.2)}}

/* preview back button */
#backBtn{
  position:absolute; left:12px; top:12px; z-index:5;
  padding:8px 10px; border-radius:12px; border:1px solid var(--ring);
  background:#0b1223aa; color:var(--ink); backdrop-filter:blur(6px);
}

/* mobile center column */
@media (min-width:700px){#app{max-width:520px;margin:auto;}}
</style>
</head>
<body>
<div id="loader"><div class="orb">◎</div></div>
<div id="app">
  <header>
    <div class="row">
      <div class="title">KOBLLUX — Editor Mix</div>
      <div class="actions" style="display:flex;gap:6px">
        <input class="hidden" type="file" id="uploadInput" accept=".html,text/html"/>
        <button class="ghost" id="uploadBtn" title="Upload HTML">Upload</button>
        <button class="ghost" id="downloadBtn" title="Download HTML">Download</button>
      </div>
    </div>
  </header>
  <main>
    <textarea id="editor" placeholder="Cole ou edite seu HTML aqui..."></textarea>
    <div id="preview" class="hidden">
      <button id="backBtn">← Voltar</button>
      <iframe id="view"></iframe>
    </div>
  </main>
  <div class="toolbar">
    <button class="primary" id="applyBtn">Aplicar Patch</button>
    <button id="toggleBtn">Visualizar</button>
    <button class="save" id="saveBtn">Salvar</button>
  </div>
</div>

<script>
(()=>{'use strict';
const $=q=>document.querySelector(q);
const editor=$('#editor'), view=$('#view'), loader=$('#loader');
const preview=$('#preview'), toggleBtn=$('#toggleBtn');

/* loader */
window.addEventListener('load',()=>{
  gsap.to(loader,{opacity:0,duration:.8,delay:.4,onComplete:()=>loader.classList.add('hide')});
  gsap.from('header',{y:-30,opacity:0,duration:.6,ease:'power2.out'});
});

/* alternar editor/preview */
let showing='editor';
function showEditor(){
  showing='editor';
  preview.classList.add('hidden');
  editor.classList.remove('hidden');
  toggleBtn.textContent='Visualizar';
  gsap.from(editor,{opacity:0,y:10,duration:.3,ease:'power2.out'});
}
function showPreview(){
  showing='preview';
  editor.classList.add('hidden');
  preview.classList.remove('hidden');
  toggleBtn.textContent='Editar';
  gsap.from(preview,{opacity:0,y:10,duration:.3,ease:'power2.out'});
}
$('#backBtn').onclick=showEditor;
toggleBtn.onclick=()=> showing==='editor' ? showPreview() : showEditor();

/* aplicar patch no iframe */
$('#applyBtn').onclick=()=>{
  const html=editor.value;
  const doc=view.contentDocument||view.contentWindow.document;
  doc.open();doc.write(html);doc.close();
  if(showing!=='preview') showPreview();
  gsap.from(view,{opacity:0,y:20,duration:.4});
};

/* upload HTML */
$('#uploadBtn').onclick=()=> $('#uploadInput').click();
$('#uploadInput').addEventListener('change', async (e)=>{
  const f=e.target.files && e.target.files[0]; if(!f) return;
  const text=await f.text();
  editor.value=text;
  gsap.from(editor,{opacity:0.2, duration:.2});
});

/* download HTML */
$('#downloadBtn').onclick=()=>{
  const blob=new Blob([editor.value||''],{type:'text/html'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='kobllux_patch.html';
  a.click();
  URL.revokeObjectURL(a.href);
  gsap.fromTo('#downloadBtn',{scale:1},{scale:1.15,yoyo:true,repeat:1,duration:.18});
};

/* salvar no localStorage */
$('#saveBtn').onclick=()=>{
  localStorage.setItem('kobllux_patch',editor.value);
  gsap.fromTo('#saveBtn',{scale:1},{scale:1.2,yoyo:true,repeat:1,duration:.2,ease:'power1.inOut'});
};

/* carregar patch salvo */
const saved=localStorage.getItem('kobllux_patch'); if(saved){editor.value=saved;}

/* SW */
if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }

/* atalhos */
addEventListener('keydown',e=>{
  if((e.ctrlKey||e.metaKey) && e.key==='Enter'){ e.preventDefault(); $('#applyBtn').click(); }
  if(e.key==='Escape' && showing==='preview'){ showEditor(); }
});
})();
</script>
</body>
</html>
